---
alwaysApply: true
---

# Schema & Route Sync Rule

You are working in a TypeScript codebase using auto-generated OpenAPI Zod clients.

## Single Source of Truth

- `src/generated/openapi.zod.ts` is the ONLY authoritative API definition.
- Frontend hooks, API utils, and components MUST conform to it.

## Automatic AI Input

Before making any API-related change, ALWAYS read:

- `.cursor/schema-route-changes.json` (if exists)

This file contains:

- Added / modified / removed schemas
- Added / modified / removed API routes

## Mandatory Workflow

### Step 0 — Endpoint validation

- Scan all `api.*` usages in the codebase
- Verify each method exists in `openapi.zod.ts`
- If a method no longer exists:
  - Treat as ROUTE CHANGE
  - Migrate hook and all call sites to the new method

### Step 1 — Schema impact analysis

For every schema listed in:

- `schemas.added`
- `schemas.modified`

You MUST:

- Identify all endpoints using the schema
- Identify request vs response usage
- Identify all hooks and components referencing it

### Step 2 — Hooks update / creation

- Update existing hooks to match the latest schema EXACTLY
- If a hook is missing:
  - Create a new hook following project conventions
  - Name: `useXxxQuery` or `useXxxMutation`
  - Use generated API client only

### Step 3 — Route registration

If a route is added or modified:

- Update `src/apis/util.api.ts`
- Register correct suffix / base path

### Step 4 — Reference integrity (STRICT)

For every modified schema or route:

- Update ALL references
- Respect:
  - optional fields
  - nullable fields
  - nested objects
- Do NOT assume backward compatibility

## Output Rules

- Apply changes directly
- Prefer minimal diffs
- TypeScript strict mode must pass
- No TODOs or placeholders

This rule is ALWAYS active.
